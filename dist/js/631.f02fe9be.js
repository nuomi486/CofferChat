"use strict";(self["webpackChunkrx"]=self["webpackChunkrx"]||[]).push([[631],{8459:function(t,e,s){s.d(e,{Z:function(){return c}});var a=function(){var t=this,e=t._self._c;return e("van-nav-bar",{attrs:{title:t.title,"left-text":"返回","left-arrow":"",fixed:"",placeholder:""},on:{"click-left":t.onClickLeft}})},i=[],o={name:"NvaBarTav",props:["title"],methods:{onClickLeft(){this.$router.go(-1)}}},l=o,n=s(3736),r=(0,n.Z)(l,a,i,!1,null,"1181aa63",null),c=r.exports},7631:function(t,e,s){s.r(e),s.d(e,{default:function(){return u}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"ShopInfo-box"},[e("NavBarTav",{attrs:{title:"商品详情"},scopedSlots:t._u([{key:"right",fn:function(){},proxy:!0}])}),e("div",[e("img",{staticClass:"auto_img",attrs:{src:t.ChatDetail.large_img}})]),e("div",{staticClass:"Detail-box"},[e("div",{staticClass:"info-box"},[e("div",{staticClass:"priceAndchatName-box clearfix"},[e("div",{staticClass:"fl"},[e("div",{staticClass:"chatName"},[t._v(t._s(t.ChatDetail.name))]),e("div",{staticClass:"chatEnName"},[t._v(t._s(t.ChatDetail.enname))])]),e("div",{staticClass:"chatPrice"},[t._v("￥"+t._s(t.ChatDetail.price))])]),e("div",{staticClass:"rule-box"},t._l(t.ChatDetail.rules,(function(s,a){return e("div",{key:a,staticClass:"rule-item clearfix"},[e("div",{staticClass:"rule-title fl"},[t._v(t._s(s.title))]),e("div",{staticClass:"fl"},t._l(s.rule,(function(a,i){return e("div",{key:i,staticClass:"r-item fl",class:{active:s.ruleIndex==i,"large-text":s.title.length>=4},on:{click:function(e){return t.onRule(s,i)}}},[t._v(" "+t._s(a.title)+" ")])})),0)])})),0),e("div",{staticClass:"c-box clearfix"},[e("div",{staticClass:"select-c fl"},[t._v("选择数量")]),e("div",{staticClass:"counts-box fr"},[e("van-stepper",{attrs:{theme:"round","button-size":"22","disable-input":""},model:{value:t.ruleData.count,callback:function(e){t.$set(t.ruleData,"count",e)},expression:"ruleData.count"}})],1)]),e("div",{staticClass:"desc-box"},[e("div",{staticClass:"desc-title"},[t._v("商品描述")]),e("div",{staticClass:"desc-text"},[e("div",{staticClass:"context"},t._l(t.ChatDetail.desc,(function(s,a){return e("div",{key:a,staticClass:"text-item"},[t._v(" "+t._s(a+1)+"、"+t._s(s)+" ")])})),0)])])])]),e("van-goods-action",[e("van-goods-action-icon",{attrs:{icon:"bag",badge:t.shoppCounts,text:"购物袋"},on:{click:t.goBagPage}}),e("van-goods-action-icon",{attrs:{icon:"like",color:t.isLike?"#ff5000":"",text:"收藏"},on:{click:t.onUpLike}}),e("van-goods-action-button",{attrs:{type:"warning",color:"#0934BA",text:"加入购物袋"},on:{click:function(e){return t.onAddBag(!1)}}}),e("van-goods-action-button",{attrs:{type:"danger",color:"#00adb5",text:"立即购买"},on:{click:function(e){return t.onAddBag(!0)}}})],1)],1)},i=[],o=s(8459),l={name:"ShopInfoView",data(){return{ChatDetail:{},rule:[],ruleData:{pid:"",count:1},shoppCounts:"",isLike:!1}},computed:{pid(){return this.ruleData.pid=sessionStorage.getItem("chatPid"),this.ruleData.pid}},watch:{rule(){let t=[];this.rule.map((e=>{t.push(e,"/")})),t.pop();let e="";t.map((t=>{e+=t})),this.ruleData.rule=e}},methods:{getChatDetail(){this.$toast.loading({message:"加载中……",forbidClick:!0,duration:0}),this.axios({method:"GET",url:"/productDetail",params:{appkey:this.appkey,pid:this.pid}}).then((t=>{if(this.$toast.clear(),600==t.data.code){let e=t.data.result[0];e.desc=e.desc.split(/\n/);let s=[],a=["tem","sugar","milk","cream"];a.map((t=>{let a={};a.title=e[t+"_desc"],a.ruleIndex=0,a.rule=[];let i=e[t].split("/");i.map((t=>{""!=t&&a.rule.push({title:t})})),a.rule.length>0&&s.push(a)})),e.rules=s,this.ChatDetail=e,this.$store.commit("SetRecording",this.pid)}}),(t=>{console.log(t)}))},onClickLeft(){this.$router.go(-1)},onRule(t,e){t.ruleIndex!=e&&(t.ruleIndex=e)},onAddBag(t){let e=sessionStorage.getItem("userToken");e||(this.$toast("请先登录"),this.$router.push({name:"Login"}));let s={tokenString:e,appkey:this.appkey,count:this.ruleData.count,pid:this.ruleData.pid},a=[];this.ChatDetail.rules.map((t=>{a.push(t.rule[t.ruleIndex].title)})),s.rule=a.join("/"),this.$toast.loading({message:"加载中……",forbidClick:!0,duration:0}),this.axios({method:"post",url:"/addShopcart",data:s}).then((e=>{if(this.$toast.clear(),3e3==e.data.code)if(t){let t=[];t.push(e.data.sid),sessionStorage.setItem("sidKeys",JSON.stringify(t)),this.$router.push({name:"Pay"})}else 1==e.data.status?(this.$toast(e.data.msg),this.shoppCounts++):this.$toast("修改数量成功")}),(t=>{console.log(t)}))},getShoppCounts(){let t=sessionStorage.getItem("userToken");this.$toast.loading({message:"加载中……",forbidClick:!0,duration:0}),this.axios({method:"GET",url:"/shopcartCount",params:{appkey:this.appkey,tokenString:t}}).then((t=>{this.$toast.clear(),this.shoppCounts=t.data.result}),(t=>{console.log(t)}))},goBagPage(){this.$router.push({name:"Shopbag"}),sessionStorage.setItem("indexName","Shopbag"),this.$store.commit("SetIndexName","Shopbag")},getLike(){let t=sessionStorage.getItem("userToken");this.$toast.loading({message:"加载中……",forbidClick:!0,duration:0}),this.axios({method:"GET",url:"/findlike",params:{appkey:this.appkey,pid:this.ruleData.pid,tokenString:t}}).then((t=>{this.$toast.clear(),t.data.result.length>0&&(this.isLike=!this.isLike)}),(t=>{console.log(t)}))},onUpLike(){let t=sessionStorage.getItem("userToken"),e="";e=this.isLike?"/notlike":"/like",this.$toast.loading({message:"加载中……",forbidClick:!0,duration:0}),this.axios({method:"post",url:e,data:{appkey:this.appkey,pid:this.ruleData.pid,tokenString:t}}).then((t=>{this.$toast.clear(),800==t.data.code?(this.isLike=!0,this.$toast(t.data.msg)):900==t.data.code?(this.isLike=!1,this.$toast(t.data.msg)):(this.$toast(t.data.msg),this.$router.push({name:"Login"}))}),(t=>{console.log(t)}))}},beforeMount(){this.getChatDetail(),this.getShoppCounts(),this.getLike()},components:{NavBarTav:o.Z}},n=l,r=s(3736),c=(0,r.Z)(n,a,i,!1,null,"0bf16680",null),u=c.exports}}]);
//# sourceMappingURL=631.f02fe9be.js.map